<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ãƒãƒ£ãƒ«ç‘æƒ³ã‚¬ã‚¤ãƒ‰ - Virtual Meditation Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* èƒŒæ™¯ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a237e 0%, #0a0a0a 100%);
            animation: breatheBackground 8s ease-in-out infinite;
        }

        @keyframes breatheBackground {
            0%, 100% {
                background: radial-gradient(ellipse at center, #1a237e 0%, #0a0a0a 100%);
            }
            50% {
                background: radial-gradient(ellipse at center, #3949ab 0%, #1a237e 100%);
            }
        }

        /* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            from {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            to {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }

        .container {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 20px;
            max-width: 800px;
            width: 100%;
        }

        h1 {
            color: white;
            font-size: 3em;
            font-weight: 300;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 2s ease-out forwards;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* å‘¼å¸ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ */
        .breathing-circle {
            width: 300px;
            height: 300px;
            margin: 0 auto 40px;
            position: relative;
            opacity: 0;
            animation: fadeIn 2s ease-out 0.5s forwards;
        }

        .circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transition: all 4s ease-in-out;
        }

        .circle.breathing {
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                border-color: rgba(255, 255, 255, 0.3);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.3);
                border-color: rgba(255, 255, 255, 0.8);
                box-shadow: 0 0 40px rgba(255, 255, 255, 0.6);
            }
        }

        .breath-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5em;
            font-weight: 300;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .breath-text.show {
            opacity: 1;
        }

        /* ã‚»ãƒƒã‚·ãƒ§ãƒ³é¸æŠ */
        .session-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeIn 2s ease-out 1s forwards;
        }

        .session-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .session-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .session-card.active {
            background: rgba(100, 126, 234, 0.3);
            border-color: rgba(100, 126, 234, 0.8);
        }

        .session-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .session-title {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .session-duration {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .controls {
            opacity: 0;
            animation: fadeIn 2s ease-out 1.5s forwards;
        }

        .control-btn {
            padding: 15px 40px;
            margin: 0 10px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
        }

        .control-btn.primary:hover {
            box-shadow: 0 5px 30px rgba(102, 126, 234, 0.5);
        }

        /* ã‚¿ã‚¤ãƒãƒ¼ */
        .timer {
            color: white;
            font-size: 2em;
            margin: 30px 0;
            font-weight: 300;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .timer.show {
            opacity: 1;
        }

        /* éŸ³å£°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .sound-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 20;
        }

        .sound-toggle {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* ã‚¬ã‚¤ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆ */
        .guide-text {
            color: white;
            font-size: 1.3em;
            line-height: 1.8;
            max-width: 600px;
            margin: 30px auto;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .guide-text.show {
            opacity: 1;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2em;
            }
            
            .breathing-circle {
                width: 250px;
                height: 250px;
            }
            
            .circle {
                width: 150px;
                height: 150px;
            }
            
            .session-selector {
                grid-template-columns: 1fr;
            }
            
            .controls {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .control-btn {
                width: 100%;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="particles" id="particles"></div>
    
    <div class="container">
        <h1>ğŸ§˜ ãƒãƒ¼ãƒãƒ£ãƒ«ç‘æƒ³ã‚¬ã‚¤ãƒ‰</h1>
        
        <div class="session-selector" id="sessionSelector">
            <div class="session-card" data-session="breathing" data-duration="5">
                <div class="session-icon">ğŸŒ¬ï¸</div>
                <div class="session-title">å‘¼å¸ç‘æƒ³</div>
                <div class="session-duration">5åˆ†</div>
            </div>
            
            <div class="session-card" data-session="body-scan" data-duration="10">
                <div class="session-icon">ğŸ§˜</div>
                <div class="session-title">ãƒœãƒ‡ã‚£ã‚¹ã‚­ãƒ£ãƒ³</div>
                <div class="session-duration">10åˆ†</div>
            </div>
            
            <div class="session-card" data-session="mindfulness" data-duration="15">
                <div class="session-icon">ğŸ¯</div>
                <div class="session-title">ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹</div>
                <div class="session-duration">15åˆ†</div>
            </div>
            
            <div class="session-card" data-session="sleep" data-duration="20">
                <div class="session-icon">ğŸ˜´</div>
                <div class="session-title">ç¡çœ ç‘æƒ³</div>
                <div class="session-duration">20åˆ†</div>
            </div>
        </div>
        
        <div class="breathing-circle" id="breathingCircle" style="display: none;">
            <div class="circle" id="circle"></div>
            <div class="breath-text" id="breathText">å¸ã£ã¦</div>
        </div>
        
        <div class="guide-text" id="guideText"></div>
        
        <div class="timer" id="timer"></div>
        
        <div class="controls">
            <button class="control-btn primary" id="startBtn">ç‘æƒ³ã‚’å§‹ã‚ã‚‹</button>
            <button class="control-btn" id="pauseBtn" style="display: none;">ä¸€æ™‚åœæ­¢</button>
            <button class="control-btn" id="stopBtn" style="display: none;">çµ‚äº†</button>
        </div>
    </div>
    
    <div class="sound-controls">
        <button class="sound-toggle" id="soundToggle">ğŸ”Š</button>
    </div>

    <script>
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 20 + 20) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
        let selectedSession = null;
        let isPlaying = false;
        let isPaused = false;
        let currentTime = 0;
        let totalTime = 0;
        let timerInterval = null;
        let breathInterval = null;
        let soundEnabled = true;

        // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
        let audioContext = null;
        let oscillator = null;
        let gainNode = null;

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³é¸æŠ
        document.querySelectorAll('.session-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.session-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                selectedSession = this.dataset.session;
                totalTime = parseInt(this.dataset.duration) * 60;
            });
        });

        // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªåˆæœŸåŒ–
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // ç’°å¢ƒéŸ³ã®ç”Ÿæˆ
        function playAmbientSound() {
            if (!soundEnabled || !audioContext) return;
            
            // ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼
            const bufferSize = 2 * audioContext.sampleRate;
            const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            
            const whiteNoise = audioContext.createBufferSource();
            whiteNoise.buffer = noiseBuffer;
            whiteNoise.loop = true;
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 1000;
            
            gainNode = audioContext.createGain();
            gainNode.gain.value = 0.05;
            
            whiteNoise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            whiteNoise.start();
            
            return whiteNoise;
        }

        // ãƒãƒ£ã‚¤ãƒ ã‚µã‚¦ãƒ³ãƒ‰
        function playChime() {
            if (!soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 528; // Love frequency
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 2);
        }

        // ç‘æƒ³ã‚¬ã‚¤ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆ
        const meditationGuides = {
            breathing: [
                "æ¥½ãªå§¿å‹¢ã§åº§ã‚Šã€ç›®ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚",
                "è‡ªç„¶ãªå‘¼å¸ã«æ„è­˜ã‚’å‘ã‘ã¾ã—ã‚‡ã†ã€‚",
                "æ¯ã‚’å¸ã†ã¨ãã€ãŠè…¹ãŒè†¨ã‚‰ã‚€ã®ã‚’æ„Ÿã˜ã¦ãã ã•ã„ã€‚",
                "æ¯ã‚’åãã¨ãã€ä½“ã®ç·Šå¼µãŒè§£ã‘ã¦ã„ãã¾ã™ã€‚",
                "å‘¼å¸ã®ãƒªã‚ºãƒ ã«èº«ã‚’å§”ã­ã¾ã—ã‚‡ã†ã€‚"
            ],
            'body-scan': [
                "ä½“ã‚’ãƒªãƒ©ãƒƒã‚¯ã‚¹ã•ã›ã€æ·±å‘¼å¸ã‚’ã—ã¾ã—ã‚‡ã†ã€‚",
                "è¶³ã®å…ˆã‹ã‚‰æ„è­˜ã‚’å‘ã‘ã¦ã„ãã¾ã™ã€‚",
                "ã‚†ã£ãã‚Šã¨ä½“ã®å„éƒ¨åˆ†ã«æ³¨æ„ã‚’å‘ã‘ã¦ãã ã•ã„ã€‚",
                "ç·Šå¼µã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚Œã°ã€æ¯ã‚’åããªãŒã‚‰ç·©ã‚ã¾ã™ã€‚",
                "å…¨èº«ãŒãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦ã„ãã®ã‚’æ„Ÿã˜ã¦ãã ã•ã„ã€‚"
            ],
            mindfulness: [
                "ä»Šã“ã®ç¬é–“ã«æ„è­˜ã‚’é›†ä¸­ã•ã›ã¾ã—ã‚‡ã†ã€‚",
                "æ€è€ƒãŒæµ®ã‹ã‚“ã§ãã¦ã‚‚ã€åˆ¤æ–­ã›ãšã«è¦³å¯Ÿã—ã¾ã™ã€‚",
                "å‘¼å¸ã«æ„è­˜ã‚’æˆ»ã—ã€ä»Šã“ã“ã«ã„ã‚‹ã“ã¨ã‚’æ„Ÿã˜ã¦ãã ã•ã„ã€‚",
                "å‘¨ã‚Šã®éŸ³ã€ä½“ã®æ„Ÿè¦šã«æ°—ã¥ã„ã¦ã„ãã¾ã™ã€‚",
                "ã™ã¹ã¦ã‚’ã‚ã‚Šã®ã¾ã¾ã«å—ã‘å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚"
            ],
            sleep: [
                "ä½“ã‚’å®Œå…¨ã«ãƒªãƒ©ãƒƒã‚¯ã‚¹ã•ã›ã¦ãã ã•ã„ã€‚",
                "æ·±ãã‚†ã£ãã‚Šã¨ã—ãŸå‘¼å¸ã‚’ç¶šã‘ã¾ã™ã€‚",
                "ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚’æ‰‹æ”¾ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
                "å¿ƒåœ°ã‚ˆã„çœ ã‚Šã¸ã¨å°ã‹ã‚Œã¦ã„ãã¾ã™ã€‚",
                "å®‰ã‚‰ã‹ãªçœ ã‚Šã«åŒ…ã¾ã‚Œã¦ãã ã•ã„ã€‚"
            ]
        };

        // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
        function updateTimer() {
            const minutes = Math.floor((totalTime - currentTime) / 60);
            const seconds = (totalTime - currentTime) % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (currentTime >= totalTime) {
                stopMeditation();
                playChime();
                showGuideText("ç‘æƒ³ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã‚†ã£ãã‚Šã¨ç›®ã‚’é–‹ã‘ã¦ãã ã•ã„ã€‚");
            }
        }

        // ã‚¬ã‚¤ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
        function showGuideText(text) {
            const guideTextEl = document.getElementById('guideText');
            guideTextEl.textContent = text;
            guideTextEl.classList.add('show');
        }

        // å‘¼å¸ã‚¬ã‚¤ãƒ‰
        function startBreathingGuide() {
            const circle = document.getElementById('circle');
            const breathText = document.getElementById('breathText');
            const breathingCircle = document.getElementById('breathingCircle');
            
            breathingCircle.style.display = 'block';
            circle.classList.add('breathing');
            
            let inhaling = true;
            breathText.classList.add('show');
            
            breathInterval = setInterval(() => {
                if (inhaling) {
                    breathText.textContent = 'åã„ã¦';
                } else {
                    breathText.textContent = 'å¸ã£ã¦';
                }
                inhaling = !inhaling;
            }, 4000);
        }

        // ç‘æƒ³é–‹å§‹
        function startMeditation() {
            if (!selectedSession) {
                alert('ç‘æƒ³ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            initAudio();
            isPlaying = true;
            isPaused = false;
            currentTime = 0;
            
            document.getElementById('sessionSelector').style.display = 'none';
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('timer').classList.add('show');
            
            updateTimer();
            
            if (selectedSession === 'breathing') {
                startBreathingGuide();
            }
            
            // ã‚¬ã‚¤ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆã®è¡¨ç¤º
            const guides = meditationGuides[selectedSession];
            let guideIndex = 0;
            
            showGuideText(guides[guideIndex]);
            
            const guideInterval = setInterval(() => {
                if (!isPlaying || isPaused) return;
                
                guideIndex = (guideIndex + 1) % guides.length;
                showGuideText(guides[guideIndex]);
            }, totalTime * 1000 / guides.length);
            
            // ç’°å¢ƒéŸ³ã®å†ç”Ÿ
            const ambientSound = playAmbientSound();
            
            // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    currentTime++;
                    updateTimer();
                }
            }, 1000);
            
            // ãƒãƒ£ã‚¤ãƒ éŸ³
            playChime();
        }

        // ç‘æƒ³ä¸€æ™‚åœæ­¢
        function pauseMeditation() {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? 'å†é–‹' : 'ä¸€æ™‚åœæ­¢';
            
            if (isPaused && breathInterval) {
                clearInterval(breathInterval);
                document.getElementById('circle').classList.remove('breathing');
            } else if (!isPaused && selectedSession === 'breathing') {
                startBreathingGuide();
            }
        }

        // ç‘æƒ³åœæ­¢
        function stopMeditation() {
            isPlaying = false;
            isPaused = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            if (breathInterval) {
                clearInterval(breathInterval);
            }
            
            document.getElementById('sessionSelector').style.display = 'grid';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('timer').classList.remove('show');
            document.getElementById('breathingCircle').style.display = 'none';
            document.getElementById('circle').classList.remove('breathing');
            document.getElementById('guideText').classList.remove('show');
            
            // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªåœæ­¢
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
        }

        // ã‚µã‚¦ãƒ³ãƒ‰ãƒˆã‚°ãƒ«
        document.getElementById('soundToggle').addEventListener('click', function() {
            soundEnabled = !soundEnabled;
            this.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            
            if (!soundEnabled && gainNode) {
                gainNode.gain.value = 0;
            } else if (soundEnabled && gainNode) {
                gainNode.gain.value = 0.05;
            }
        });

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('startBtn').addEventListener('click', startMeditation);
        document.getElementById('pauseBtn').addEventListener('click', pauseMeditation);
        document.getElementById('stopBtn').addEventListener('click', stopMeditation);

        // åˆæœŸåŒ–
        createParticles();
    </script>
</body>
</html>